<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Meu Player</title>

<style>
*{
    margin:0;
    padding:0;
    box-sizing:border-box;
    font-family:Arial, sans-serif;
}

body{
    background:linear-gradient(180deg,#121212,#000);
    color:white;
    display:flex;
    justify-content:center;
    align-items:center;
    height:100vh;
}

.container{
    width:95%;
    max-width:420px;
    background:#181818;
    border-radius:20px;
    padding:20px;
    box-shadow:0 0 40px rgba(0,0,0,0.6);
    display:flex;
    flex-direction:column;
}

h1{
    text-align:center;
    margin-bottom:15px;
    color:#1DB954;
}

.cover{
    width:100%;
    height:220px;
    background:url("InShot_20241030_060449517.jpg");
    background-size:cover;
    background-position:center;
    border-radius:15px;
    margin-bottom:15px;
}

.music-info{
    text-align:center;
    margin-bottom:10px;
}

.progress-container{
    display:flex;
    align-items:center;
    gap:5px;
    font-size:12px;
}

input[type="range"]{
    width:100%;
}

.controls{
    display:flex;
    justify-content:center;
    gap:20px;
    margin:15px 0;
}

button{
    background:#1DB954;
    border:none;
    color:white;
    font-size:16px;
    padding:10px;
    border-radius:50%;
    cursor:pointer;
    transition:0.3s;
}

.playing{
    transform:scale(1.2);
    box-shadow:0 0 15px #1DB954;
}

.playlist{
    max-height:170px;
    overflow-y:auto;
    border-top:1px solid #333;
    padding-top:10px;
}

.playlist-item{
    display:flex;
    justify-content:space-between;
    align-items:center;
    padding:6px;
    border-radius:8px;
    font-size:14px;
}

.playlist-item:hover{
    background:#282828;
}

.active{
    background:#1DB954;
}

.small-btn{
    font-size:11px;
    padding:4px 6px;
    border-radius:6px;
    margin-left:4px;
}
</style>
</head>

<body>

<div class="container">
    <h1>TINHOLIST</h1>

    <div class="cover"></div>

    <div class="music-info">
        <h3 id="title">Nenhuma m√∫sica selecionada</h3>
    </div>

    <div class="progress-container">
        <span id="currentTime">0:00</span>
        <input type="range" id="progress" value="0">
        <span id="duration">0:00</span>
    </div>

    <div class="controls">
        <button onclick="prevSong()">‚èÆ</button>
        <button id="playBtn" onclick="togglePlay()">‚ñ∂</button>
        <button onclick="nextSong()">‚è≠</button>
    </div>

    üîä <input type="range" id="volume" min="0" max="1" step="0.01" value="1">

    <input type="file" id="fileInput" accept="audio/*" multiple>

    <div class="playlist" id="playlist"></div>
</div>

<audio id="audio"></audio>

<script>
const audio = document.getElementById("audio");
const fileInput = document.getElementById("fileInput");
const playlistDiv = document.getElementById("playlist");
const title = document.getElementById("title");
const progress = document.getElementById("progress");
const currentTimeEl = document.getElementById("currentTime");
const durationEl = document.getElementById("duration");
const volume = document.getElementById("volume");
const playBtn = document.getElementById("playBtn");

let db;
let songs = [];
let currentIndex = 0;

/* ================= DATABASE ================= */

const request = indexedDB.open("MusicDB",1);

request.onupgradeneeded = e=>{
    db = e.target.result;
    db.createObjectStore("songs",{keyPath:"id",autoIncrement:true});
};

request.onsuccess = e=>{
    db = e.target.result;
    loadSongs();
};

function saveSong(file){
    const reader = new FileReader();
    reader.onload = function(){
        const tx = db.transaction(["songs"],"readwrite");
        const store = tx.objectStore("songs");
        store.add({
            name:file.name.replace(/\.[^/.]+$/,""),
            data:reader.result
        });
        loadSongs();
    };
    reader.readAsDataURL(file);
}

function loadSongs(){
    const tx = db.transaction(["songs"],"readonly");
    const store = tx.objectStore("songs");
    const req = store.getAll();
    req.onsuccess = function(){
        songs = req.result;
        renderPlaylist();
    };
}

function deleteSong(id){
    const tx = db.transaction(["songs"],"readwrite");
    const store = tx.objectStore("songs");
    store.delete(id);
    loadSongs();
}

function updateSongName(id,newName){
    const tx = db.transaction(["songs"],"readwrite");
    const store = tx.objectStore("songs");
    const req = store.get(id);
    req.onsuccess = function(){
        const data = req.result;
        data.name = newName;
        store.put(data);
        loadSongs();
    };
}

/* ================= FILE INPUT ================= */

fileInput.addEventListener("change",function(){
    Array.from(this.files).forEach(file=>saveSong(file));
});

/* ================= PLAYLIST ================= */

function renderPlaylist(){
    playlistDiv.innerHTML="";
    songs.forEach((song,index)=>{
        const div = document.createElement("div");
        div.classList.add("playlist-item");
        if(index===currentIndex) div.classList.add("active");

        let shortName = song.name.length>25
            ? song.name.substring(0,25)+"..."
            : song.name;

        div.innerHTML=`
            <span onclick="loadSong(${index})">${shortName}</span>
            <div>
                <button class="small-btn" onclick="editName(${song.id})">‚úè</button>
                <button class="small-btn" onclick="deleteSong(${song.id})">X</button>
            </div>
        `;
        playlistDiv.appendChild(div);
    });
}

function editName(id){
    const newName = prompt("Novo nome da m√∫sica:");
    if(newName && newName.trim()!==""){
        updateSongName(id,newName.trim());
    }
}

/* ================= PLAYER ================= */

function loadSong(index){
    currentIndex=index;
    audio.src=songs[index].data;
    title.innerText=songs[index].name;
    audio.play();
    playBtn.innerText="‚è∏";
    playBtn.classList.add("playing");
    renderPlaylist();
}

function togglePlay(){
    if(!audio.src) return;
    if(audio.paused){
        audio.play();
        playBtn.innerText="‚è∏";
        playBtn.classList.add("playing");
    }else{
        audio.pause();
        playBtn.innerText="‚ñ∂";
        playBtn.classList.remove("playing");
    }
}

function nextSong(){
    if(currentIndex<songs.length-1){
        loadSong(currentIndex+1);
    }
}

function prevSong(){
    if(currentIndex>0){
        loadSong(currentIndex-1);
    }
}

audio.addEventListener("timeupdate",()=>{
    progress.value=(audio.currentTime/audio.duration)*100;
    currentTimeEl.innerText=formatTime(audio.currentTime);
    durationEl.innerText=formatTime(audio.duration);
});

progress.addEventListener("input",()=>{
    audio.currentTime=(progress.value/100)*audio.duration;
});

volume.addEventListener("input",()=>{
    audio.volume=volume.value;
});

audio.addEventListener("ended",nextSong);

function formatTime(time){
    if(isNaN(time)) return "0:00";
    const m=Math.floor(time/60);
    const s=Math.floor(time%60);
    return m+":"+(s<10?"0"+s:s);
}
</script>

</body>
</html>
